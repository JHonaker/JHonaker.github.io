---
layout: post
title: "The First Stop in Monte Carlo (Methods): Rejection Sampling"
published: false
comments: true
tags: [R, "Monte Carlo"]
---

```{r setup echo=FALSE, messagse=FALSE, results='hide'}
library(ggplot2)
```

# Context

Monte Carlo: site of the Formula 1 Monaco Grand Prix, home to a world-famous casino, and the name of a series of interesting algorithms.

How many times have you been driving down the road thinking, "I really wish I could sample some random variables from a non-standard distribution!" Probably never.

(Application for drawing from a non-standard distribution, discrete or continuous)

## The Basics

Let's say we're interested in sampling from some completely off the wall distribution, like say this zig-zag function:

$$
z(x) = \left\{
    \begin{align}{lr}
        x & 0 \le x < 1 \\
        x - 1 & 1 \le x < 2 \\
        0 & \text{otherwise} \\
    \end{align}
    \right.
$$

```{r zig-zag}
zig.zag <- function(x) {
    if (0 <= x && x < 1) x
    else if (1 <= x && x < 2) x - 1
    else 0
}

x <- seq(0, 2, by = 0.01)
y <- sapply(x, zig.zag)

qplot(x, y, geom = 'line')
```

Does this look even look like a probability distribution function? No, it doesn't. It's not even a continuous function, and with rejection sampling it doesn't even have to be a valid PDF! So how do we go about drawing from it, and how does it work?

### The 10,000 feet high perspective

To start off, we draw a box that completely surrounds our zig-zag function. Then, we pick a point at random from our box. If it falls under our zig-zag function, we say we accept this point and return it in the sample. If it falls above the zig-zag function, we reject it and repeat the drawing process. Do this again and again until you get the number of samples that you want. It's a very simple algorithm.

Let's look at an example outcome of these drawings.

```{r}
# We want 20 samples from our zig-zag
N <- 20
i <- 1
draws <- c()
ret <- c()

while (i <= N) {
    # Draw a number along the width of the box
    # (the support of zig-zag)
    T <- runif(1, min=0, max=2)
    # Draw a number along the height of the box
    U <- runif(1, min=0, max=1)

    draws <- rbind(draws, c(T, U))

    # If the point is under the zig-zag,
    # accept it
    if (U <= zig.zag(T)) {
        ret <- c(ret, T)
        n <- n + 1
    }
    # Otherwise, try again
}


```

## Down the Rabbit Hole (Diving Into the Details)



### Great, but can you prove it?



#### Feel free to skip this part if you don't want to see the theory!



# Your Turn


```{r}
N <- 1
i <- 1
x <- c()
while (i <= N) {
    x[i] <- q(x)
    u <- runif(1)
    if (u < p(x[i]) / M * q(x[i])) {
        accept x[i]
        i <- i + 1
    else
        reject x[i]
    }
}
```
